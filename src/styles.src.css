@layer theme, base, components, utilities;
@import 'tailwindcss/theme.css' layer(theme);
@import 'tailwindcss/utilities.css' layer(utilities);

/* ========================================
   TIME MACHINE - PLUGIN STYLES
   Isolated in the components layer to avoid
   leaking into Obsidian's global styles.
   ======================================== */

@layer components {
    /* ========================================
       SUPPORT & UI SECTIONS
       ======================================== */

    /* Support section */
    .support-header-margin {
        @apply mb-5;
    }

    /* ========================================
       TIME MACHINE - ROOT
       ======================================== */

    .tm-root {
        @apply flex flex-col h-full overflow-hidden;
    }

    /* ========================================
       TIME MACHINE - HEADER
       ======================================== */

    .tm-header {
        @apply flex items-center justify-between gap-2 px-3 py-1.5;
        border-bottom: 1px solid var(--background-modifier-border);
    }

    .tm-header-file {
        @apply text-xs font-medium truncate min-w-0;
        color: var(--text-normal);
    }

    .tm-header-count {
        @apply text-xs shrink-0;
        color: var(--text-faint);
    }

    /* ========================================
       TIME MACHINE - CONTENT
       ======================================== */

    .tm-content {
        @apply flex flex-col flex-1 overflow-y-auto;
    }

    /* ========================================
       TIME MACHINE - EMPTY STATE
       ======================================== */

    .tm-empty-state {
        @apply flex flex-col items-center justify-center gap-3 px-6 py-10;
    }

    .tm-empty-state-icon {
        @apply opacity-40;
        color: var(--text-muted);
    }

    .tm-empty-state-icon svg {
        @apply w-10 h-10;
    }

    .tm-empty-state-text {
        @apply text-sm m-0 text-center;
        color: var(--text-muted);
    }

    .tm-empty-state-hint {
        @apply text-xs m-0 text-center;
        color: var(--text-faint);
    }

    /* ========================================
       TIME MACHINE - TIMELINE SLIDER
       ======================================== */

    .tm-timeline-slider {
        @apply flex flex-col gap-2 px-3 py-2;
        border-bottom: 1px solid var(--background-modifier-border);
    }

    /* Wrapper ensures the input stretches to full width */
    .tm-timeline-slider-wrap {
        @apply relative w-full;
    }

    /* --- Range input: reset & full-width override --- */
    .tm-timeline-slider-input {
        @apply block cursor-pointer;
        -webkit-appearance: none;
        appearance: none;
        /* Override Obsidian's input[type='range'] { width: 100px } */
        width: 100% !important;
        min-width: 0;
        max-width: none;
        /* Height matches thumb so it stays vertically centered */
        height: 20px;
        margin: 0;
        padding: 0;
        border: none;
        outline: none;
        background: transparent;
        box-sizing: border-box;
        --slider-progress: 0%;
    }

    /* --- WebKit track (Chrome, Safari, Edge) --- */
    .tm-timeline-slider-input::-webkit-slider-runnable-track {
        width: 100%;
        height: 8px;
        border-radius: 4px;
        border: none;
        background: linear-gradient(
            to right,
            var(--interactive-accent) 0%,
            var(--interactive-accent) var(--slider-progress),
            var(--background-modifier-border) var(--slider-progress),
            var(--background-modifier-border) 100%
        );
        transition: background 60ms ease;
    }

    /* --- Firefox track --- */
    .tm-timeline-slider-input::-moz-range-track {
        width: 100%;
        height: 8px;
        border-radius: 4px;
        border: none;
        background: linear-gradient(
            to right,
            var(--interactive-accent) 0%,
            var(--interactive-accent) var(--slider-progress),
            var(--background-modifier-border) var(--slider-progress),
            var(--background-modifier-border) 100%
        );
    }

    /* Firefox filled portion (progressive fill built-in) */
    .tm-timeline-slider-input::-moz-range-progress {
        height: 8px;
        border-radius: 4px 0 0 4px;
        background: var(--interactive-accent);
    }

    /* --- WebKit thumb --- */
    .tm-timeline-slider-input::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--interactive-accent);
        border: 3px solid var(--background-primary);
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.25);
        cursor: pointer;
        transition:
            transform 120ms ease,
            box-shadow 120ms ease;
    }

    .tm-timeline-slider-input:hover::-webkit-slider-thumb {
        transform: scale(1.15);
        box-shadow:
            0 2px 8px rgba(0, 0, 0, 0.3),
            0 0 0 4px color-mix(in srgb, var(--interactive-accent) 20%, transparent);
    }

    .tm-timeline-slider-input:active::-webkit-slider-thumb {
        transform: scale(1.05);
        box-shadow:
            0 1px 3px rgba(0, 0, 0, 0.3),
            0 0 0 6px color-mix(in srgb, var(--interactive-accent) 25%, transparent);
    }

    /* --- Firefox thumb --- */
    .tm-timeline-slider-input::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--interactive-accent);
        border: 3px solid var(--background-primary);
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.25);
        cursor: pointer;
        transition:
            transform 120ms ease,
            box-shadow 120ms ease;
    }

    .tm-timeline-slider-input:hover::-moz-range-thumb {
        transform: scale(1.15);
        box-shadow:
            0 2px 8px rgba(0, 0, 0, 0.3),
            0 0 0 4px color-mix(in srgb, var(--interactive-accent) 20%, transparent);
    }

    .tm-timeline-slider-input:active::-moz-range-thumb {
        transform: scale(1.05);
        box-shadow:
            0 1px 3px rgba(0, 0, 0, 0.3),
            0 0 0 6px color-mix(in srgb, var(--interactive-accent) 25%, transparent);
    }

    /* --- Focus ring for accessibility --- */
    .tm-timeline-slider-input:focus-visible::-webkit-slider-thumb {
        box-shadow:
            0 1px 4px rgba(0, 0, 0, 0.25),
            0 0 0 3px var(--background-primary),
            0 0 0 5px var(--interactive-accent);
    }

    .tm-timeline-slider-input:focus-visible::-moz-range-thumb {
        box-shadow:
            0 1px 4px rgba(0, 0, 0, 0.25),
            0 0 0 3px var(--background-primary),
            0 0 0 5px var(--interactive-accent);
    }

    /* --- Edge date labels --- */
    .tm-timeline-slider-edges {
        @apply flex justify-between gap-2 min-w-0;
    }

    .tm-timeline-slider-edge-label {
        @apply text-xs truncate shrink min-w-0;
        color: var(--text-faint);
        letter-spacing: 0.01em;
    }

    /* --- Selected snapshot display --- */
    .tm-timeline-slider-selected {
        @apply flex items-center justify-center gap-1.5;
    }

    .tm-timeline-slider-selected-date {
        @apply text-xs font-semibold truncate;
        color: var(--text-normal);
    }

    .tm-timeline-slider-selected-sep {
        @apply text-xs;
        color: var(--text-faint);
    }

    .tm-timeline-slider-selected-relative {
        @apply text-xs truncate;
        color: var(--text-faint);
    }

    /* --- Source indicator --- */
    .tm-timeline-slider-selected-source {
        @apply flex items-center justify-center gap-1.5;
    }

    .tm-timeline-slider-source-icon {
        @apply inline-flex shrink-0;
    }

    .tm-timeline-slider-source-icon svg {
        @apply w-3 h-3;
        color: var(--text-faint);
    }

    .tm-timeline-slider-source-label {
        @apply text-xs truncate;
        color: var(--text-muted);
    }

    .tm-timeline-slider-source-author {
        @apply text-xs truncate;
        color: var(--text-faint);
    }

    /* ========================================
       TIME MACHINE - DIFF VIEWER
       ======================================== */

    .tm-diff-container {
        @apply flex-1 overflow-y-auto;
    }

    .tm-diff-viewer {
        @apply flex flex-col gap-1.5 p-2;
    }

    .tm-diff-no-changes {
        @apply text-xs text-center py-4;
        color: var(--text-faint);
    }

    .tm-diff-toolbar {
        @apply flex justify-end mb-1;
    }

    .tm-restore-full-btn {
        @apply flex items-center gap-1 px-2 py-1 text-xs rounded cursor-pointer flex-wrap;
        background-color: var(--interactive-normal);
        border: 1px solid var(--background-modifier-border);
        color: var(--text-normal);
        transition: background-color 100ms ease;
    }

    .tm-restore-full-btn:hover {
        background-color: var(--interactive-hover);
    }

    .tm-restore-btn-icon {
        @apply inline-flex;
    }

    .tm-restore-btn-icon svg {
        @apply w-3.5 h-3.5;
    }

    .tm-diff-hunk {
        @apply rounded overflow-hidden;
        border: 1px solid var(--background-modifier-border);
    }

    .tm-diff-hunk-header {
        @apply flex items-center justify-between px-2 py-1 text-xs;
        background-color: var(--background-secondary);
        color: var(--text-faint);
        font-family: var(--font-monospace);
    }

    .tm-diff-hunk-range {
        @apply text-xs truncate min-w-0;
    }

    .tm-restore-hunk-btn {
        @apply p-1 rounded cursor-pointer;
        color: var(--text-muted);
    }

    .tm-restore-hunk-btn:hover {
        color: var(--text-normal);
        background-color: var(--background-modifier-hover);
    }

    .tm-diff-lines {
        @apply text-xs overflow-x-auto;
        font-family: var(--font-monospace);
    }

    .tm-diff-line {
        @apply flex px-1.5;
        line-height: 1.4;
    }

    .tm-diff-context {
        background-color: transparent;
    }

    .tm-diff-added {
        background-color: rgba(0, 180, 0, 0.12);
    }

    .tm-diff-removed {
        background-color: rgba(220, 0, 0, 0.12);
    }

    .tm-diff-line-prefix {
        @apply inline-block w-4 shrink-0 select-none;
        color: var(--text-faint);
    }

    .tm-diff-line-content {
        @apply whitespace-pre-wrap break-all;
    }

    /* ========================================
       TIME MACHINE - CONFIRM DIALOG
       ======================================== */

    .tm-confirm-buttons {
        @apply flex justify-end gap-2 mt-4;
    }
}
